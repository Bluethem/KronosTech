# Diseño Relacional

## Diagrama Relacional

![Diagrama Conceptual]()

---

## Diccionario de Datos

### MÓDULO 1: CATÁLOGO Y BÚSQUEDA

#### **1. Familia**
- **Descripción:** Agrupación de nivel superior de productos (ej: Hardware, Periféricos)
- **Propósito:** Organizar productos en categorías amplias
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Debe tener al menos una categoría asociada
  - El nombre debe ser único
  - Puede estar activa o inactiva

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_familia | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| nombre | Nombre de la familia | Identificación | VARCHAR(100) | Sí | Sí | "Hardware" |
| descripcion | Descripción detallada | Informativo | TEXT | No | No | "Componentes principales" |
| icono | URL del icono | Visual | VARCHAR(255) | No | No | "/icons/hardware.svg" |
| slug | URL amigable | SEO | VARCHAR(100) | Sí | Sí | "hardware" |
| orden | Orden de visualización | Organización | INTEGER | Sí | No | 1 |
| estado | Estado de la familia | Control | ENUM | Sí | No | "activo" |

---

#### **2. Categoría**
- **Descripción:** Clasificación intermedia de productos (ej: Tarjetas Gráficas, Procesadores)
- **Propósito:** Organizar productos dentro de familias
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Debe pertenecer a una familia
  - Puede tener subcategorías
  - El nombre debe ser único dentro de su familia

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_categoria | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| nombre | Nombre de la categoría | Identificación | VARCHAR(100) | Sí | No | "Tarjetas Gráficas" |
| descripcion | Descripción detallada | Informativo | TEXT | No | No | "GPUs gaming" |
| icono | URL del icono | Visual | VARCHAR(255) | No | No | "/icons/gpu.svg" |
| slug | URL amigable | SEO | VARCHAR(100) | Sí | Sí | "tarjetas-graficas" |
| id_familia | Referencia a familia | Relación | INTEGER | Sí | No | 1 |
| orden | Orden de visualización | Organización | INTEGER | Sí | No | 1 |
| estado | Estado de la categoría | Control | ENUM | Sí | No | "activo" |

**Cardinalidad con Familia:** (1,N) - Una familia tiene muchas categorías

---

#### **3. Subcategoría**
- **Descripción:** Subdivisión de categorías (ej: Gaming, Workstation, Mining)
- **Propósito:** Clasificación más específica de productos
- **Tipo:** Entidad Débil (depende de Categoría)
- **Reglas de negocio:**
  - Debe pertenecer a una categoría
  - El nombre debe ser único dentro de su categoría

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_subcategoria | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| nombre | Nombre de la subcategoría | Identificación | VARCHAR(100) | Sí | No | "Gaming" |
| descripcion | Descripción detallada | Informativo | TEXT | No | No | "Para juegos" |
| slug | URL amigable | SEO | VARCHAR(100) | Sí | Sí | "gaming" |
| id_categoria | Referencia a categoría | Relación | INTEGER | Sí | No | 1 |
| orden | Orden de visualización | Organización | INTEGER | Sí | No | 1 |
| estado | Estado de la subcategoría | Control | ENUM | Sí | No | "activo" |

**Cardinalidad con Categoría:** (1,N) - Una categoría tiene muchas subcategorías

---

#### **4. Marca**
- **Descripción:** Fabricante de productos (ej: ASUS, MSI, Corsair)
- **Propósito:** Identificar el fabricante de productos
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - El nombre debe ser único
  - Puede fabricar múltiples productos

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_marca | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| nombre | Nombre de la marca | Identificación | VARCHAR(100) | Sí | Sí | "ASUS" |
| descripcion | Descripción de la marca | Informativo | TEXT | No | No | "ASUSTeK Computer Inc." |
| logo | URL del logo | Visual | VARCHAR(255) | No | No | "/logos/asus.png" |
| slug | URL amigable | SEO | VARCHAR(100) | Sí | Sí | "asus" |
| pais_origen | País de origen | Informativo | VARCHAR(100) | No | No | "Taiwán" |
| estado | Estado de la marca | Control | ENUM | Sí | No | "activo" |

---

#### **5. Producto (Tipo de Producto)**
- **Descripción:** Definición del tipo de producto (ej: "NVIDIA RTX 4090")
- **Propósito:** Servir como plantilla para productos específicos
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Debe pertenecer a una categoría
  - Puede tener múltiples instancias (Producto_Detalle)
  - Agrupa las valoraciones de todas sus instancias

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_producto | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| nombre | Nombre del tipo | Identificación | VARCHAR(200) | Sí | No | "NVIDIA RTX 4090" |
| descripcion | Descripción general | Informativo | TEXT | No | No | "GPU de alta gama" |
| slug | URL amigable | SEO | VARCHAR(200) | Sí | Sí | "nvidia-rtx-4090" |
| id_categoria | Referencia a categoría | Relación | INTEGER | Sí | No | 1 |
| id_subcategoria | Referencia a subcategoría | Relación | INTEGER | No | No | 1 |
| especificaciones_base | Specs comunes | Técnico | JSONB | No | No | {"memoria":"24GB"} |
| imagen_referencia | Imagen del tipo | Visual | VARCHAR(255) | No | No | "/imgs/rtx4090.jpg" |
| valoracion_promedio | Valoración promedio | Estadístico | DECIMAL(3,2) | Sí | No | 4.75 |
| total_valoraciones | Total de valoraciones | Estadístico | INTEGER | Sí | No | 150 |
| estado | Estado del producto | Control | ENUM | Sí | No | "activo" |

**Cardinalidad:**
- Con Categoría: (N,1) - Muchos productos pertenecen a una categoría
- Con Subcategoría: (N,1) - Muchos productos pertenecen a una subcategoría (opcional)
- Con Producto_Detalle: (1,N) - Un producto tiene muchas instancias

---

#### **6. Producto_Detalle (Instancia del Producto)**
- **Descripción:** Instancia específica de un producto (ej: "ASUS ROG Strix RTX 4090 OC")
- **Propósito:** Representar productos vendibles específicos con marca y modelo
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Debe tener un tipo de producto asociado
  - Debe tener una marca
  - El SKU debe ser único
  - Controla su propio inventario

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_producto_detalle | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| nombre | Nombre completo | Identificación | VARCHAR(200) | Sí | No | "ASUS ROG Strix RTX 4090 OC 24GB" |
| descripcion | Descripción específica | Informativo | TEXT | No | No | "Con overclock de fábrica" |
| modelo | Modelo específico | Identificación | VARCHAR(100) | No | No | "ROG-STRIX-RTX4090-O24G" |
| sku | Código único | Identificación | VARCHAR(100) | Sí | Sí | "ASU-4090-001" |
| slug | URL amigable | SEO | VARCHAR(200) | Sí | Sí | "asus-rog-strix-rtx-4090" |
| id_producto | Referencia al tipo | Relación | INTEGER | Sí | No | 1 |
| id_marca | Referencia a marca | Relación | INTEGER | Sí | No | 1 |
| precio_base | Precio sin descuento | Financiero | DECIMAL(10,2) | Sí | No | 1899.99 |
| precio_venta | Precio actual | Financiero | DECIMAL(10,2) | Sí | No | 1799.99 |
| imagen_principal | Imagen principal | Visual | VARCHAR(255) | No | No | "/imgs/product1.jpg" |
| imagenes | Galería de imágenes | Visual | JSONB | No | No | ["img1.jpg","img2.jpg"] |
| peso | Peso en kg | Logístico | DECIMAL(8,2) | No | No | 2.5 |
| dimensiones | Dimensiones físicas | Logístico | VARCHAR(100) | No | No | "30x12x5 cm" |
| garantia_meses | Meses de garantía | Servicio | INTEGER | Sí | No | 36 |
| total_vendidos | Unidades vendidas | Estadístico | INTEGER | Sí | No | 47 |
| vistas | Número de vistas | Estadístico | INTEGER | Sí | No | 1250 |
| es_destacado | Si es destacado | Marketing | BOOLEAN | Sí | No | true |
| es_nuevo | Si es nuevo | Marketing | BOOLEAN | Sí | No | false |
| es_oferta | Si está en oferta | Marketing | BOOLEAN | Sí | No | true |
| estado | Estado del producto | Control | ENUM | Sí | No | "activo" |

**Cardinalidad:**
- Con Producto: (N,1) - Muchas instancias de un tipo
- Con Marca: (N,1) - Muchos productos de una marca
- Con Inventario: (1,1) - Cada producto tiene un inventario

---

#### **7. Especificacion_Producto**
- **Descripción:** Especificaciones técnicas detalladas del producto
- **Propósito:** Almacenar atributos técnicos dinámicos
- **Tipo:** Entidad Débil (depende de Producto_Detalle)
- **Reglas de negocio:**
  - Debe pertenecer a un producto detalle
  - Permite especificaciones personalizadas por producto

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_especificacion | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_producto_detalle | Referencia al producto | Relación | INTEGER | Sí | No | 1 |
| nombre_atributo | Nombre del atributo | Identificación | VARCHAR(100) | Sí | No | "Memoria VRAM" |
| valor_atributo | Valor del atributo | Dato | TEXT | Sí | No | "24GB" |
| unidad_medida | Unidad de medida | Especificación | VARCHAR(50) | No | No | "GB" |
| orden | Orden de visualización | Organización | INTEGER | Sí | No | 1 |

**Cardinalidad con Producto_Detalle:** (N,1) - Muchas especificaciones por producto

---

#### **8. Imagen_Producto**
- **Descripción:** Galería de imágenes del producto
- **Propósito:** Mostrar múltiples vistas del producto
- **Tipo:** Entidad Débil (depende de Producto_Detalle)
- **Reglas de negocio:**
  - Debe pertenecer a un producto detalle
  - Solo una puede ser principal

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_imagen | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_producto_detalle | Referencia al producto | Relación | INTEGER | Sí | No | 1 |
| url_imagen | URL de la imagen | Dato | VARCHAR(255) | Sí | No | "/imgs/prod1_view2.jpg" |
| es_principal | Si es imagen principal | Control | BOOLEAN | Sí | No | false |
| orden | Orden de visualización | Organización | INTEGER | Sí | No | 2 |
| alt_text | Texto alternativo | Accesibilidad | VARCHAR(200) | No | No | "Vista lateral" |

**Cardinalidad con Producto_Detalle:** (N,1) - Muchas imágenes por producto

---

#### **9. Descuento**
- **Descripción:** Promociones y descuentos aplicables
- **Propósito:** Gestionar descuentos temporales en productos
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Tiene fecha de inicio y fin
  - Puede aplicarse a productos, categorías o marcas
  - Puede tener límite de usos

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_descuento | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| nombre | Nombre del descuento | Identificación | VARCHAR(100) | Sí | No | "Black Friday RTX" |
| descripcion | Descripción del descuento | Informativo | TEXT | No | No | "15% en tarjetas RTX" |
| tipo_descuento | Tipo de descuento | Clasificación | ENUM | Sí | No | "porcentaje" |
| valor | Valor del descuento | Financiero | DECIMAL(10,2) | Sí | No | 15.00 |
| aplica_a | A qué aplica | Clasificación | ENUM | Sí | No | "producto" |
| id_referencia | ID del objeto | Relación | INTEGER | No | No | 1 |
| fecha_inicio | Inicio de vigencia | Temporal | TIMESTAMP | Sí | No | "2025-11-25 00:00" |
| fecha_fin | Fin de vigencia | Temporal | TIMESTAMP | Sí | No | "2025-11-30 23:59" |
| activo | Si está activo | Control | BOOLEAN | Sí | No | true |

**Cardinalidad:** (N,M) con Producto/Categoría/Marca - Un descuento puede aplicar a múltiples entidades

---

#### **10. Valoracion**
- **Descripción:** Reseña y calificación de un producto por un cliente
- **Propósito:** Permitir que clientes valoren productos
- **Tipo:** Entidad Asociativa (relaciona Usuario con Producto)
- **Reglas de negocio:**
  - Un usuario solo puede valorar un producto una vez
  - Debe estar asociada a una compra verificada (opcional)
  - Requiere aprobación antes de publicarse

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_valoracion | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_producto | Referencia al producto | Relación | INTEGER | Sí | No | 1 |
| id_usuario | Referencia al usuario | Relación | INTEGER | Sí | No | 5 |
| id_producto_detalle | Producto específico comprado | Relación | INTEGER | No | No | 1 |
| calificacion | Estrellas (1-5) | Valoración | INTEGER | Sí | No | 5 |
| titulo | Título de la reseña | Informativo | VARCHAR(200) | No | No | "Excelente rendimiento" |
| comentario | Comentario detallado | Informativo | TEXT | No | No | "Funciona perfecto..." |
| compra_verificada | Si compró el producto | Verificación | BOOLEAN | Sí | No | true |
| votos_util | Votos útiles | Estadístico | INTEGER | Sí | No | 15 |
| aprobado | Si está aprobada | Moderación | BOOLEAN | Sí | No | true |

**Cardinalidad:**
- Con Producto: (N,1) - Muchas valoraciones por producto
- Con Usuario: (N,1) - Muchas valoraciones por usuario
- Restricción: UNIQUE(id_usuario, id_producto)

---

#### **11. Imagen_Valoracion**
- **Descripción:** Imágenes adjuntas a una valoración
- **Propósito:** Permitir que usuarios suban fotos del producto
- **Tipo:** Entidad Débil (depende de Valoracion)
- **Reglas de negocio:**
  - Debe pertenecer a una valoración

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_imagen_valoracion | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_valoracion | Referencia a valoración | Relación | INTEGER | Sí | No | 1 |
| url_imagen | URL de la imagen | Dato | VARCHAR(255) | Sí | No | "/reviews/img1.jpg" |
| orden | Orden de visualización | Organización | INTEGER | Sí | No | 1 |

**Cardinalidad con Valoracion:** (N,1) - Muchas imágenes por valoración

---

#### **12. Banner**
- **Descripción:** Banners promocionales de la página de inicio
- **Propósito:** Mostrar promociones destacadas en el carrusel
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Puede tener vigencia temporal
  - Tiene un orden de visualización

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_banner | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| titulo | Título del banner | Informativo | VARCHAR(200) | Sí | No | "Black Friday 2025" |
| subtitulo | Subtítulo | Informativo | VARCHAR(200) | No | No | "Hasta 50% off" |
| imagen_desktop | Imagen para desktop | Visual | VARCHAR(255) | Sí | No | "/banners/bf_desk.jpg" |
| imagen_mobile | Imagen para móvil | Visual | VARCHAR(255) | No | No | "/banners/bf_mobile.jpg" |
| url_destino | URL de destino | Navegación | VARCHAR(255) | No | No | "/ofertas/black-friday" |
| orden | Orden en el carrusel | Organización | INTEGER | Sí | No | 1 |
| activo | Si está activo | Control | BOOLEAN | Sí | No | true |
| fecha_inicio | Inicio de vigencia | Temporal | TIMESTAMP | No | No | "2025-11-20 00:00" |
| fecha_fin | Fin de vigencia | Temporal | TIMESTAMP | No | No | "2025-12-01 23:59" |

---

### MÓDULO 2: COMPRAS Y PAGOS

#### **13. Usuario**
- **Descripción:** Persona que utiliza el sistema (cliente o administrador)
- **Propósito:** Gestionar usuarios del sistema
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - El email debe ser único
  - Debe tener un rol asignado
  - La contraseña debe estar hasheada

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_usuario | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| nombre | Nombre del usuario | Identificación | VARCHAR(100) | Sí | No | "Juan" |
| apellido | Apellido del usuario | Identificación | VARCHAR(100) | Sí | No | "Pérez" |
| email | Correo electrónico | Autenticación | VARCHAR(255) | Sí | Sí | "juan@email.com" |
| contrasena | Hash de contraseña | Seguridad | VARCHAR(255) | Sí | No | "$argon2id$..." |
| telefono | Teléfono de contacto | Comunicación | VARCHAR(20) | No | No | "987654321" |
| dni | DNI del usuario | Identificación | VARCHAR(20) | No | No | "72345678" |
| rol | Rol del usuario | Autorización | ENUM | Sí | No | "cliente" |
| email_verificado | Si verificó su email | Control | BOOLEAN | Sí | No | true |
| activo | Si está activo | Control | BOOLEAN | Sí | No | true |

**Cardinalidad:**
- Con Direccion: (1,N) - Un usuario tiene muchas direcciones
- Con Carrito: (1,1) - Un usuario tiene un carrito activo
- Con Venta: (1,N) - Un usuario realiza muchas compras
- Con Valoracion: (1,N) - Un usuario hace muchas valoraciones

---

#### **14. Direccion**
- **Descripción:** Dirección de envío o facturación del usuario
- **Propósito:** Almacenar direcciones del cliente
- **Tipo:** Entidad Débil (depende de Usuario)
- **Reglas de negocio:**
  - Debe pertenecer a un usuario
  - Un usuario puede tener múltiples direcciones
  - Solo una puede ser predeterminada

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_direccion | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_usuario | Referencia al usuario | Relación | INTEGER | Sí | No | 1 |
| tipo | Tipo de dirección | Clasificación | ENUM | Sí | No | "envio" |
| nombre_completo | Nombre del destinatario | Identificación | VARCHAR(200) | No | No | "Juan Pérez" |
| direccion_linea1 | Dirección principal | Ubicación | TEXT | Sí | No | "Av. Principal 123" |
| direccion_linea2 | Dirección adicional | Ubicación | TEXT | No | No | "Dpto 501" |
| ciudad | Ciudad | Ubicación | VARCHAR(100) | Sí | No | "Lima" |
| departamento | Departamento/Estado | Ubicación | VARCHAR(100) | Sí | No | "Lima" |
| codigo_postal | Código postal | Ubicación | VARCHAR(20) | No | No | "15001" |
| telefono_contacto | Teléfono de contacto | Comunicación | VARCHAR(20) | No | No | "987654321" |
| referencia | Referencia de ubicación | Orientación | TEXT | No | No | "Frente al parque" |
| es_predeterminada | Si es predeterminada | Control | BOOLEAN | Sí | No | true |
| activo | Si está activa | Control | BOOLEAN | Sí | No | true |

**Cardinalidad con Usuario:** (N,1) - Muchas direcciones de un usuario

---

#### **15. Carrito**
- **Descripción:** Carrito de compras temporal del usuario
- **Propósito:** Almacenar productos antes de la compra
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Un usuario registrado tiene máximo un carrito activo
  - Usuarios no registrados usan id_sesion
  - Puede expirar después de cierto tiempo

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_carrito | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_usuario | Referencia al usuario | Relación | INTEGER | No | No | 1 |
| id_sesion | ID de sesión anónima | Identificación | VARCHAR(100) | No | No | "sess_abc123" |
| estado | Estado del carrito | Control | ENUM | Sí | No | "activo" |
| fecha_expiracion | Fecha de expiración | Control | TIMESTAMP | No | No | "2025-11-15 12:00" |

**Cardinalidad:**
- Con Usuario: (N,1) - Muchos carritos (histórico) de un usuario
- Con Carrito_Detalle: (1,N) - Un carrito tiene muchos items

**Restricción:** Solo un carrito activo por usuario

---

#### **16. Carrito_Detalle**
- **Descripción:** Items individuales en el carrito
- **Propósito:** Registrar productos agregados al carrito
- **Tipo:** Entidad Débil (depende de Carrito)
- **Reglas de negocio:**
  - Debe pertenecer a un carrito
  - No puede haber productos duplicados en un carrito
  - La cantidad debe ser mayor a 0

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_carrito_detalle | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_carrito | Referencia al carrito | Relación | INTEGER | Sí | No | 1 |
| id_producto_detalle | Referencia al producto | Relación | INTEGER | Sí | No | 1 |
| cantidad | Cantidad solicitada | Control | INTEGER | Sí | No | 2 |
| precio_unitario | Precio al agregar | Financiero | DECIMAL(10,2) | Sí | No | 1799.99 |

**Cardinalidad:**
- Con Carrito: (N,1) - Muchos items en un carrito
- Con Producto_Detalle: (N,1) - Muchos carritos pueden tener el mismo producto

**Restricción:** UNIQUE(id_carrito, id_producto_detalle)

---

#### **17. Venta (Pedido)**
- **Descripción:** Registro de una compra realizada
- **Propósito:** Gestionar pedidos de clientes
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Debe tener un usuario asociado
  - El número de pedido debe ser único
  - Debe tener al menos un producto en detalle_venta
  - Pasa por múltiples estados

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_venta | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| numero_pedido | Número de pedido | Identificación | VARCHAR(50) | Sí | Sí | "PED-20251114-0001" |
| id_usuario | Referencia al usuario | Relación | INTEGER | Sí | No | 1 |
| id_carrito | Referencia al carrito | Relación | INTEGER | No | No | 1 |
| subtotal | Subtotal sin descuentos | Financiero | DECIMAL(10,2) | Sí | No | 3599.98 |
| descuento_total | Total de descuentos | Financiero | DECIMAL(10,2) | Sí | No | 180.00 |
| costo_envio | Costo de envío | Financiero | DECIMAL(10,2) | Sí | No | 15.00 |
| total | Total a pagar | Financiero | DECIMAL(10,2) | Sí | No | 3434.98 |
| moneda | Moneda del pago | Financiero | VARCHAR(3) | Sí | No | "PEN" |
| estado | Estado del pedido | Control | ENUM | Sí | No | "confirmado" |
| estado_pago | Estado del pago | Control | ENUM | Sí | No | "pagado" |
| direccion_envio | Dirección de envío | Logístico | TEXT | No | No | "Av. Principal 123" |
| ciudad | Ciudad de envío | Logístico | VARCHAR(100) | No | No | "Lima" |
| departamento | Departamento de envío | Logístico | VARCHAR(100) | No | No | "Lima" |
| telefono_contacto | Teléfono de contacto | Comunicación | VARCHAR(20) | No | No | "987654321" |
| metodo_envio | Método de envío | Logístico | VARCHAR(100) | No | No | "Express" |
| numero_tracking | Número de tracking | Logístico | VARCHAR(100) | No | No | "TRACK123456" |
| fecha_pedido | Fecha del pedido | Temporal | TIMESTAMP | Sí | No | "2025-11-14 10:30" |
| fecha_pago | Fecha del pago | Temporal | TIMESTAMP | No | No | "2025-11-14 10:32" |
| fecha_envio | Fecha de envío | Temporal | TIMESTAMP | No | No | "2025-11-15 08:00" |
| fecha_entrega | Fecha de entrega | Temporal | TIMESTAMP | No | No | "2025-11-17 14:20" |
| notas_cliente | Notas del cliente | Informativo | TEXT | No | No | "Entregar por la tarde" |
| ip_cliente | IP del cliente | Seguridad | VARCHAR(45) | No | No | "192.168.1.100" |

**Cardinalidad:**
- Con Usuario: (N,1) - Muchas ventas de un usuario
- Con Carrito: (N,1) - Una venta se origina de un carrito
- Con Detalle_Venta: (1,N) - Una venta tiene muchos productos
- Con Pago: (1,N) - Una venta puede tener múltiples pagos (ej: reintento)

---

#### **18. Detalle_Venta**
- **Descripción:** Productos vendidos en un pedido
- **Propósito:** Registrar qué productos se vendieron en cada pedido
- **Tipo:** Entidad Débil (depende de Venta)
- **Reglas de negocio:**
  - Debe pertenecer a una venta
  - Guarda snapshot del precio al momento de venta
  - Referencia al producto_detalle específico

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_detalle_venta | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_venta | Referencia a la venta | Relación | INTEGER | Sí | No | 1 |
| id_producto_detalle | Referencia al producto | Relación | INTEGER | Sí | No | 1 |
| cantidad | Cantidad vendida | Control | INTEGER | Sí | No | 2 |
| precio_unitario | Precio al momento de venta | Financiero | DECIMAL(10,2) | Sí | No | 1799.99 |
| descuento_unitario | Descuento por unidad | Financiero | DECIMAL(10,2) | Sí | No | 90.00 |
| precio_final | Precio después descuento | Financiero | DECIMAL(10,2) | Sí | No | 1709.99 |
| subtotal | Subtotal línea | Financiero | DECIMAL(10,2) | Sí | No | 3419.98 |

**Cardinalidad:**
- Con Venta: (N,1) - Muchos detalles en una venta
- Con Producto_Detalle: (N,1) - Muchas ventas del mismo producto

---

#### **19. Cupon**
- **Descripción:** Cupón de descuento promocional
- **Propósito:** Ofrecer códigos de descuento a clientes
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - El código debe ser único
  - Tiene vigencia temporal
  - Puede tener límite de usos global y por usuario

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_cupon | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| codigo | Código del cupón | Identificación | VARCHAR(50) | Sí | Sí | "BIENVENIDO10" |
| nombre | Nombre del cupón | Informativo | VARCHAR(100) | Sí | No | "Cupón Bienvenida" |
| descripcion | Descripción | Informativo | TEXT | No | No | "10% off primera compra" |
| tipo_cupon | Tipo de cupón | Clasificación | ENUM | Sí | No | "porcentaje" |
| valor | Valor del descuento | Financiero | DECIMAL(10,2) | Sí | No | 10.00 |
| aplica_a | A qué aplica | Clasificación | ENUM | Sí | No | "todo" |
| id_referencia | ID del objeto | Relación | INTEGER | No | No | NULL |
| compra_minima | Compra mínima requerida | Financiero | DECIMAL(10,2) | Sí | No | 100.00 |
| usos_maximos | Usos máximos globales | Control | INTEGER | No | No | 1000 |
| usos_maximos_por_usuario | Usos por usuario | Control | INTEGER | Sí | No | 1 |
| usos_actuales | Usos actuales | Estadístico | INTEGER | Sí | No | 47 |
| fecha_inicio | Inicio de vigencia | Temporal | TIMESTAMP | Sí | No | "2025-11-01 00:00" |
| fecha_fin | Fin de vigencia | Temporal | TIMESTAMP | Sí | No | "2025-12-31 23:59" |
| solo_nuevos_usuarios | Solo usuarios nuevos | Restricción | BOOLEAN | Sí | No | true |
| activo | Si está activo | Control | BOOLEAN | Sí | No | true |

**Cardinalidad con Venta:** (N,M) a través de Uso_Cupon

---

#### **20. Uso_Cupon**
- **Descripción:** Registro de uso de cupones en ventas
- **Propósito:** Auditar el uso de cupones
- **Tipo:** Entidad Asociativa (relaciona Venta con Cupon)
- **Reglas de negocio:**
  - Registra cada uso de un cupón
  - Permite trackear qué cupón usó cada venta

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_uso_cupon | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_cupon | Referencia al cupón | Relación | INTEGER | Sí | No | 1 |
| id_venta | Referencia a la venta | Relación | INTEGER | Sí | No | 1 |
| id_usuario | Referencia al usuario | Relación | INTEGER | Sí | No | 1 |
| descuento_aplicado | Descuento real aplicado | Financiero | DECIMAL(10,2) | Sí | No | 180.00 |

**Cardinalidad:**
- Con Cupon: (N,1) - Muchos usos de un cupón
- Con Venta: (N,1) - Una venta puede usar un cupón
- Con Usuario: (N,1) - Muchos usos por usuario

---

#### **21. Metodo_Pago**
- **Descripción:** Catálogo de métodos de pago disponibles
- **Propósito:** Definir métodos de pago aceptados
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Define los métodos disponibles en la tienda
  - Cada método tiene comisiones asociadas

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_metodo_pago | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| nombre | Nombre del método | Identificación | VARCHAR(100) | Sí | No | "Tarjeta Visa" |
| tipo | Tipo de método | Clasificación | ENUM | Sí | No | "tarjeta_credito" |
| proveedor | Proveedor del servicio | Informativo | VARCHAR(100) | No | No | "Visa" |
| descripcion | Descripción | Informativo | TEXT | No | No | "Pago con tarjeta Visa" |
| icono | URL del icono | Visual | VARCHAR(255) | No | No | "/icons/visa.svg" |
| comision_porcentaje | Comisión porcentual | Financiero | DECIMAL(5,2) | Sí | No | 2.9 |
| comision_fija | Comisión fija | Financiero | DECIMAL(10,2) | Sí | No | 0.30 |
| tiempo_procesamiento | Tiempo de proceso | Informativo | VARCHAR(50) | No | No | "Inmediato" |
| orden | Orden de visualización | Organización | INTEGER | Sí | No | 1 |
| activo | Si está activo | Control | BOOLEAN | Sí | No | true |

**Cardinalidad con Pago:** (1,N) - Un método usado en muchos pagos

---

#### **22. Metodo_Pago_Cliente**
- **Descripción:** Métodos de pago guardados del cliente
- **Propósito:** Permitir pagos rápidos con métodos guardados
- **Tipo:** Entidad Débil (depende de Usuario)
- **Reglas de negocio:**
  - NUNCA guarda datos reales de tarjeta, solo tokens
  - Un usuario puede tener múltiples métodos guardados
  - Solo uno puede ser predeterminado

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_metodo_pago_cliente | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_usuario | Referencia al usuario | Relación | INTEGER | Sí | No | 1 |
| id_metodo_pago | Tipo de método | Relación | INTEGER | Sí | No | 1 |
| tipo | Tipo de método | Clasificación | ENUM | Sí | No | "tarjeta_credito" |
| token_pago | Token del procesador | Seguridad | VARCHAR(200) | No | No | "tok_visa_..." |
| ultimos_4_digitos | Últimos 4 dígitos | Identificación | CHAR(4) | No | No | "4242" |
| marca | Marca de tarjeta | Informativo | VARCHAR(50) | No | No | "Visa" |
| nombre_titular | Nombre del titular | Informativo | VARCHAR(200) | No | No | "JUAN PEREZ" |
| es_predeterminado | Si es predeterminado | Control | BOOLEAN | Sí | No | true |
| activo | Si está activo | Control | BOOLEAN | Sí | No | true |

**Cardinalidad:**
- Con Usuario: (N,1) - Muchos métodos guardados por usuario
- Con Metodo_Pago: (N,1) - Muchos clientes usan el mismo tipo

---

#### **23. Pago**
- **Descripción:** Transacción de pago realizada
- **Propósito:** Registrar pagos de pedidos
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Debe estar asociado a una venta
  - Registra información del procesador de pagos
  - NUNCA guarda datos sensibles de tarjeta

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_pago | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_venta | Referencia a la venta | Relación | INTEGER | Sí | No | 1 |
| id_metodo_pago | Tipo de método usado | Relación | INTEGER | Sí | No | 1 |
| id_metodo_pago_cliente | Método guardado usado | Relación | INTEGER | No | No | 1 |
| numero_transaccion | Número de transacción | Identificación | VARCHAR(100) | No | Sí | "TXN-20251114-001" |
| estado | Estado del pago | Control | ENUM | Sí | No | "completado" |
| monto | Monto pagado | Financiero | DECIMAL(10,2) | Sí | No | 3434.98 |
| moneda | Moneda del pago | Financiero | VARCHAR(3) | Sí | No | "PEN" |
| comision | Comisión cobrada | Financiero | DECIMAL(10,2) | Sí | No | 99.61 |
| monto_neto | Monto neto recibido | Financiero | DECIMAL(10,2) | Sí | No | 3335.37 |
| proveedor_pago | Procesador de pago | Informativo | VARCHAR(50) | No | No | "Stripe" |
| id_transaccion_proveedor | ID en el procesador | Identificación | VARCHAR(200) | No | No | "ch_3Abc..." |
| token_pago | Token de un solo uso | Seguridad | VARCHAR(200) | No | No | "tok_..." |
| respuesta_proveedor | Respuesta completa | Auditoría | JSONB | No | No | {...} |
| ultimos_4_digitos | Últimos 4 dígitos | Informativo | CHAR(4) | No | No | "4242" |
| marca_tarjeta | Marca de tarjeta | Informativo | VARCHAR(50) | No | No | "Visa" |
| ip_cliente | IP del cliente | Seguridad | VARCHAR(45) | No | No | "192.168.1.100" |
| fecha_pago | Fecha del pago | Temporal | TIMESTAMP | No | No | "2025-11-14 10:32" |
| nota_error | Mensaje de error | Debugging | TEXT | No | No | NULL |
| intentos_fallidos | Intentos fallidos | Control | INTEGER | Sí | No | 0 |

**Cardinalidad:**
- Con Venta: (N,1) - Muchos pagos pueden pertenecer a una venta
- Con Metodo_Pago: (N,1) - Muchos pagos usan el mismo método
- Con Reembolso: (1,N) - Un pago puede tener reembolsos

---

#### **24. Reembolso**
- **Descripción:** Solicitud y proceso de reembolso
- **Propósito:** Gestionar devoluciones de dinero
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Debe estar asociado a un pago
  - Requiere aprobación de administrador
  - Puede ser total o parcial

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_reembolso | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_pago | Referencia al pago | Relación | INTEGER | Sí | No | 1 |
| id_venta | Referencia a la venta | Relación | INTEGER | Sí | No | 1 |
| tipo_reembolso | Tipo de reembolso | Clasificación | VARCHAR(20) | Sí | No | "total" |
| monto_reembolsado | Monto a reembolsar | Financiero | DECIMAL(10,2) | Sí | No | 3434.98 |
| motivo | Motivo del reembolso | Informativo | TEXT | Sí | No | "Producto defectuoso" |
| estado | Estado del reembolso | Control | ENUM | Sí | No | "completado" |
| id_reembolso_proveedor | ID en el procesador | Identificación | VARCHAR(200) | No | No | "re_3Abc..." |
| id_usuario_solicitante | Quien solicitó | Relación | INTEGER | No | No | 1 |
| fecha_solicitado | Fecha de solicitud | Temporal | TIMESTAMP | Sí | No | "2025-11-20 14:00" |
| fecha_completado | Fecha de completado | Temporal | TIMESTAMP | No | No | "2025-11-21 09:00" |

**Cardinalidad:**
- Con Pago: (N,1) - Muchos reembolsos de un pago (ej: parciales)
- Con Venta: (N,1) - Muchos reembolsos de una venta

---

#### **25. Notificacion**
- **Descripción:** Notificaciones para el usuario
- **Propósito:** Informar al usuario sobre eventos importantes
- **Tipo:** Entidad Débil (depende de Usuario)
- **Reglas de negocio:**
  - Debe pertenecer a un usuario
  - Puede ser leída o no leída

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_notificacion | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_usuario | Referencia al usuario | Relación | INTEGER | Sí | No | 1 |
| tipo | Tipo de notificación | Clasificación | VARCHAR(50) | Sí | No | "pedido_enviado" |
| titulo | Título | Informativo | VARCHAR(200) | Sí | No | "Tu pedido fue enviado" |
| mensaje | Mensaje completo | Informativo | TEXT | Sí | No | "Tu pedido #PED-001..." |
| url | URL de destino | Navegación | VARCHAR(255) | No | No | "/pedidos/1" |
| leida | Si fue leída | Control | BOOLEAN | Sí | No | false |

**Cardinalidad con Usuario:** (N,1) - Muchas notificaciones para un usuario

---

#### **26. Lista_Deseos**
- **Descripción:** Lista de productos deseados por el usuario
- **Propósito:** Permitir guardar productos para después
- **Tipo:** Entidad Asociativa (relaciona Usuario con Producto_Detalle)
- **Reglas de negocio:**
  - Un usuario no puede tener el mismo producto duplicado
  - Sirve como wishlist

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_lista_deseos | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_usuario | Referencia al usuario | Relación | INTEGER | Sí | No | 1 |
| id_producto_detalle | Referencia al producto | Relación | INTEGER | Sí | No | 1 |

**Cardinalidad:**
- Con Usuario: (N,1) - Muchos productos en lista de un usuario
- Con Producto_Detalle: (N,M) - Muchos usuarios pueden guardar el mismo producto

**Restricción:** UNIQUE(id_usuario, id_producto_detalle)

---

### MÓDULO 3: GESTIÓN Y ADMINISTRACIÓN

#### **27. Administrador**
- **Descripción:** Usuario con privilegios de administración
- **Propósito:** Gestionar usuarios administradores
- **Tipo:** Entidad Débil (hereda/especializa de Usuario)
- **Reglas de negocio:**
  - Debe ser un usuario del sistema
  - Tiene permisos especiales
  - Puede ser super admin

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_administrador | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_usuario | Referencia al usuario | Relación | INTEGER | Sí | Sí | 5 |
| es_super_admin | Si es super admin | Autorización | BOOLEAN | Sí | No | true |
| permisos | Permisos granulares | Autorización | JSONB | No | No | {"productos":"rw"} |

**Cardinalidad con Usuario:** (1,1) - Un administrador ES un usuario

---

#### **28. Inventario**
- **Descripción:** Control de stock de productos
- **Propósito:** Gestionar disponibilidad de productos
- **Tipo:** Entidad Débil (depende de Producto_Detalle)
- **Reglas de negocio:**
  - Cada producto detalle tiene exactamente un inventario
  - La cantidad no puede ser negativa
  - Alerta cuando cantidad < cantidad_minima

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_inventario | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_producto_detalle | Referencia al producto | Relación | INTEGER | Sí | Sí | 1 |
| cantidad_disponible | Stock disponible | Control | INTEGER | Sí | No | 47 |
| cantidad_minima | Stock mínimo | Control | INTEGER | Sí | No | 5 |
| cantidad_maxima | Stock máximo | Control | INTEGER | Sí | No | 100 |
| ubicacion_fisica | Ubicación en almacén | Logístico | VARCHAR(100) | No | No | "A-3-2" |
| lote | Número de lote | Control | VARCHAR(50) | No | No | "LOT-2025-001" |
| fecha_vencimiento | Fecha de vencimiento | Control | DATE | No | No | "2027-11-14" |

**Cardinalidad con Producto_Detalle:** (1,1) - Relación uno a uno

---

#### **29. Movimiento_Inventario**
- **Descripción:** Historial de movimientos de inventario
- **Propósito:** Auditar cambios en el stock
- **Tipo:** Entidad Débil (depende de Inventario)
- **Reglas de negocio:**
  - Registra cada cambio en el inventario
  - Inmutable una vez creado

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_movimiento | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_inventario | Referencia al inventario | Relación | INTEGER | Sí | No | 1 |
| id_producto_detalle | Referencia al producto | Relación | INTEGER | Sí | No | 1 |
| tipo_movimiento | Tipo de movimiento | Clasificación | ENUM | Sí | No | "entrada" |
| cantidad | Cantidad del movimiento | Control | INTEGER | Sí | No | 50 |
| cantidad_anterior | Stock antes | Auditoría | INTEGER | Sí | No | 47 |
| cantidad_nueva | Stock después | Auditoría | INTEGER | Sí | No | 97 |
| motivo | Motivo del movimiento | Informativo | TEXT | No | No | "Compra a proveedor" |
| id_usuario | Usuario responsable | Relación | INTEGER | No | No | 5 |
| id_venta | Venta relacionada | Relación | INTEGER | No | No | NULL |
| costo_unitario | Costo unitario | Financiero | DECIMAL(10,2) | No | No | 1600.00 |
| documento_referencia | Documento de referencia | Auditoría | VARCHAR(100) | No | No | "FAC-001" |

**Cardinalidad:**
- Con Inventario: (N,1) - Muchos movimientos de un inventario
- Con Producto_Detalle: (N,1) - Muchos movimientos de un producto

---

#### **30. Proveedor**
- **Descripción:** Proveedor de productos
- **Propósito:** Gestionar proveedores de inventario
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - RUC o identificación debe ser único
  - Puede suministrar múltiples productos

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_proveedor | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| nombre | Nombre del proveedor | Identificación | VARCHAR(200) | Sí | No | "Tech Distributors SAC" |
| ruc | RUC del proveedor | Identificación | VARCHAR(20) | No | Sí | "20512345678" |
| email | Email de contacto | Comunicación | VARCHAR(255) | No | No | "ventas@techdist.com" |
| telefono | Teléfono de contacto | Comunicación | VARCHAR(20) | No | No | "014567890" |
| direccion | Dirección del proveedor | Ubicación | TEXT | No | No | "Av. Industrial 456" |
| ciudad | Ciudad | Ubicación | VARCHAR(100) | No | No | "Lima" |
| contacto_nombre | Nombre del contacto | Comunicación | VARCHAR(200) | No | No | "María García" |
| contacto_telefono | Teléfono del contacto | Comunicación | VARCHAR(20) | No | No | "987654321" |
| activo | Si está activo | Control | BOOLEAN | Sí | No | true |

**Cardinalidad con Orden_Compra:** (1,N) - Un proveedor tiene muchas órdenes

---

#### **31. Orden_Compra**
- **Descripción:** Orden de compra a proveedores
- **Propósito:** Registrar compras de inventario
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Debe tener un proveedor asociado
  - Número de orden único
  - Genera movimientos de inventario al recibir

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_orden_compra | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| numero_orden | Número de orden | Identificación | VARCHAR(50) | Sí | Sí | "OC-2025-001" |
| id_proveedor | Referencia al proveedor | Relación | INTEGER | Sí | No | 1 |
| id_usuario | Admin que creó | Relación | INTEGER | Sí | No | 5 |
| estado | Estado de la orden | Control | VARCHAR(50) | Sí | No | "recibida" |
| subtotal | Subtotal | Financiero | DECIMAL(10,2) | Sí | No | 80000.00 |
| impuestos | Impuestos | Financiero | DECIMAL(10,2) | Sí | No | 14400.00 |
| total | Total | Financiero | DECIMAL(10,2) | Sí | No | 94400.00 |
| fecha_orden | Fecha de la orden | Temporal | TIMESTAMP | Sí | No | "2025-11-01 10:00" |
| fecha_entrega_estimada | Fecha estimada | Temporal | DATE | No | No | "2025-11-15" |
| fecha_recepcion | Fecha de recepción | Temporal | TIMESTAMP | No | No | "2025-11-14 14:00" |
| notas | Notas de la orden | Informativo | TEXT | No | No | "Entrega en almacén A" |

**Cardinalidad:**
- Con Proveedor: (N,1) - Muchas órdenes de un proveedor
- Con Detalle_Orden_Compra: (1,N) - Una orden tiene muchos productos

---

#### **32. Detalle_Orden_Compra**
- **Descripción:** Productos en una orden de compra
- **Propósito:** Registrar qué se compró en cada orden
- **Tipo:** Entidad Débil (depende de Orden_Compra)
- **Reglas de negocio:**
  - Debe pertenecer a una orden
  - Referencia al producto específico

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_detalle_orden | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_orden_compra | Referencia a la orden | Relación | INTEGER | Sí | No | 1 |
| id_producto_detalle | Referencia al producto | Relación | INTEGER | Sí | No | 1 |
| cantidad | Cantidad ordenada | Control | INTEGER | Sí | No | 50 |
| precio_unitario | Precio unitario | Financiero | DECIMAL(10,2) | Sí | No | 1600.00 |
| subtotal | Subtotal línea | Financiero | DECIMAL(10,2) | Sí | No | 80000.00 |
| cantidad_recibida | Cantidad recibida | Control | INTEGER | Sí | No | 50 |

**Cardinalidad:**
- Con Orden_Compra: (N,1) - Muchos detalles en una orden
- Con Producto_Detalle: (N,1) - Muchas órdenes del mismo producto

---

#### **33. Envio**
- **Descripción:** Información de envío del pedido
- **Propósito:** Gestionar envíos de pedidos
- **Tipo:** Entidad Fuerte
- **Reglas de negocio:**
  - Debe estar asociado a una venta
  - Una venta tiene máximo un envío

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_envio | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| id_venta | Referencia a la venta | Relación | INTEGER | Sí | Sí | 1 |
| empresa_envio | Empresa de envío | Logístico | VARCHAR(100) | No | No | "Olva Courier" |
| metodo_envio | Método de envío | Logístico | VARCHAR(100) | No | No | "Express" |
| numero_tracking | Número de tracking | Logístico | VARCHAR(100) | No | No | "TRACK123456" |
| costo | Costo del envío | Financiero | DECIMAL(10,2) | Sí | No | 15.00 |
| estado | Estado del envío | Control | ENUM | Sí | No | "en_transito" |
| direccion_completa | Dirección completa | Logístico | TEXT | No | No | "Av. Principal 123..." |
| ciudad | Ciudad | Logístico | VARCHAR(100) | No | No | "Lima" |
| departamento | Departamento | Logístico | VARCHAR(100) | No | No | "Lima" |
| telefono_contacto | Teléfono | Comunicación | VARCHAR(20) | No | No | "987654321" |
| fecha_estimada | Fecha estimada | Temporal | DATE | No | No | "2025-11-17" |
| fecha_envio | Fecha de envío | Temporal | TIMESTAMP | No | No | "2025-11-15 08:00" |
| fecha_entrega | Fecha de entrega | Temporal | TIMESTAMP | No | No | "2025-11-17 14:20" |
| historial_tracking | Historial de tracking | Auditoría | JSONB | No | No | [{...}] |
| notas | Notas del envío | Informativo | TEXT | No | No | "Entregado sin novedad" |

**Cardinalidad con Venta:** (1,1) - Relación uno a uno

---

#### **34. Auditoria**
- **Descripción:** Registro de auditoría del sistema
- **Propósito:** Auditar cambios en tablas críticas
- **Tipo:** Entidad Independiente
- **Reglas de negocio:**
  - Registra cambios importantes
  - Inmutable

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_auditoria | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| tabla | Tabla auditada | Identificación | VARCHAR(100) | Sí | No | "producto_detalle" |
| id_registro | ID del registro | Identificación | INTEGER | Sí | No | 1 |
| accion | Tipo de acción | Clasificación | VARCHAR(50) | Sí | No | "UPDATE" |
| datos_anteriores | Datos antes del cambio | Auditoría | JSONB | No | No | {...} |
| datos_nuevos | Datos después | Auditoría | JSONB | No | No | {...} |
| id_usuario | Usuario responsable | Relación | INTEGER | No | No | 5 |
| ip | IP del usuario | Seguridad | VARCHAR(45) | No | No | "192.168.1.100" |
| user_agent | User agent | Seguridad | TEXT | No | No | "Mozilla/5.0..." |

**Cardinalidad:** Entidad independiente que registra cambios en cualquier tabla

---

#### **35. Configuracion**
- **Descripción:** Configuración del sistema
- **Propósito:** Almacenar settings generales
- **Tipo:** Entidad Independiente
- **Reglas de negocio:**
  - La clave debe ser única
  - Almacena configuraciones globales

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_configuracion | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| clave | Clave de configuración | Identificación | VARCHAR(100) | Sí | Sí | "smtp_host" |
| valor | Valor de configuración | Dato | TEXT | Sí | No | "smtp.gmail.com" |
| tipo | Tipo de dato | Clasificación | VARCHAR(50) | No | No | "string" |
| descripcion | Descripción | Informativo | TEXT | No | No | "Host del servidor SMTP" |
| categoria | Categoría | Clasificación | VARCHAR(100) | No | No | "Email" |

---

#### **36. Reporte_Guardado**
- **Descripción:** Reportes guardados y programados
- **Propósito:** Gestionar reportes personalizados
- **Tipo:** Entidad Independiente
- **Reglas de negocio:**
  - Puede ejecutarse periódicamente
  - Almacena parámetros del reporte

| Atributo | Descripción | Propósito | Dominio | Obligatorio | Único | Ejemplo |
|----------|-------------|-----------|---------|-------------|-------|---------|
| id_reporte | Identificador único | Identificación | Serial | Sí | Sí | 1 |
| nombre | Nombre del reporte | Identificación | VARCHAR(200) | Sí | No | "Ventas Mensuales" |
| tipo | Tipo de reporte | Clasificación | VARCHAR(100) | Sí | No | "ventas" |
| parametros | Parámetros del reporte | Configuración | JSONB | No | No | {"mes":"11"} |
| id_usuario | Usuario creador | Relación | INTEGER | No | No | 5 |
| frecuencia | Frecuencia de ejecución | Control | VARCHAR(50) | No | No | "mensual" |
| ultima_ejecucion | Última ejecución | Temporal | TIMESTAMP | No | No | "2025-11-01 00:00" |
| activo | Si está activo | Control | BOOLEAN | Sí | No | true |

---